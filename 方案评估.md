# Email Alert - 方案评估

## 当前状况

**v4.0 个推集成持续失败：**
- Gradle 无法下载个推 SDK 依赖
- 个推认证测试也失败（错误 20001）
- 已尝试 2 次修复仍未解决

## 可选方案

### 方案 A: 改进 v3.1 轮询（推荐）⭐

**优点：**
- ✅ 已验证可以工作
- ✅ 无需第三方 SDK，构建简单
- ✅ 延迟可接受（14-78 秒，锁屏时最坏 506 秒）
- ✅ 可以进一步优化

**优化措施：**
1. 增加轮询频率：30s → 10s
2. 使用更强的 WakeLock（SCREEN_DIM_WAKE_LOCK）
3. 添加双保险：AlarmManager + Thread
4. 监听屏幕解锁事件，立即轮询

**预期效果：**
- 开屏延迟：10-20 秒
- 锁屏延迟：30-60 秒（比现在好很多）

### 方案 B: 继续调试个推集成

**需要做的：**
1. 手动下载个推 SDK AAR 文件
2. 放到项目 libs 目录
3. 修改 buildozer.spec 引用本地 AAR
4. 验证个推账号配置

**风险：**
- ❌ 可能需要多次尝试
- ❌ 个推认证问题尚未解决
- ❌ 集成复杂度高

### 方案 C: 使用 HTTP 轮询替代 SSE

**改进点：**
- 使用简单的 HTTP GET 轮询
- 服务端缓存最近 N 条消息
- 客户端每 10 秒请求一次

**优点：**
- ✅ 比 SSE 更稳定
- ✅ 实现简单
- ✅ 对网络切换更友好

## 推荐方案

**立即执行：方案 A（改进 v3.1 轮询）**

理由：
1. 快速见效，1 小时内可完成
2. 成本低，无需复杂调试
3. 对于"低延迟"需求，10-20 秒已经足够实用
4. 可以稳定运行，不依赖第三方服务

**备选方案：方案 B（个推）**

如果用户坚持要 1-5 秒延迟，可以：
1. 先用方案 A 保底
2. 并行调试个推集成
3. 调试成功后切换到个推

## 决策

请选择：

**A. 改进 v3.1 轮询版本（v3.2）**
   - 优化轮询策略
   - 目标延迟：开屏 10-20s，锁屏 30-60s
   - 1 小时内完成

**B. 继续调试个推集成（v4.0）**
   - 手动集成 AAR 文件
   - 修复认证问题
   - 预计需要 3-5 小时

**C. 两者并行**
   - 先快速实现 v3.2
   - 后台继续调试 v4.0
